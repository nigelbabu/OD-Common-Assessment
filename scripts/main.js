"use strict";Ractive.prototype.remove=function(e,t){var i=this.get(e),n=i.indexOf(t);return-1!==n?this.splice(e,n,1):Promise.defer()};var views=function(){function e(e){var t=Ractive.extend({isolated:!1,template:"#template-filter"}),i=Ractive.extend({isolated:!1,template:"#template-grouping"}),n=new Ractive({el:"#table",template:"#template-table",data:e,computed:{},components:{filter:t,grouping:i}});console.log(n.get("places")),console.log(n.get("indicators")),n.on("sorting.sort",function(e,t){this.set("sorting.column",t),this.set("sorting.direction",-1*this.get("sorting.direction"))}),n.on("indicator.remove",function(e,t){this.remove("indicators.visible",e.context),console.log(this.get("indicators.visible"))}),n.observe("indicators.visible",function(){n.set("places",services.updateScores(this.get("places"),this.get("indicators.visible")))})}return{init:e}}(),controllers=void 0,utilities=function(){function e(e,t,i){e=e.slice();var n=e.sort(function(e,n){return e[t]<n[t]?-i:i});return n}function t(e){return"y"===e.toLowerCase()||"true"===e.toLowerCase()||1==e?!0:!1}return{sort:e,isTrue:t}}(),services=function(){function e(e){var t="1kOOvztwbY1RNm545RKG8Ua6bh2GgX-P_wFadPkdH2ig";Tabletop.init({key:t,callback:function(t,i){e(i.sheets("places").elements,i.sheets("indicators").elements,i.sheets("values").elements)},simpleSheet:!1,prettyColumnNames:!1})}function t(e){for(var t={},i=[],n=[],r=[],s=0;s<e.length;s++){var o=e[s].id;t[o]=e[s],utilities.isTrue(e[s].grouping)&&n.push(o),utilities.isTrue(e[s].scoring)&&(i.push(o),utilities.isTrue(e[s]["default"])&&(r.push(o),t[o].visible=!0))}return{all:t,scoring:i,grouping:n,visible:r}}function i(e,t){return-1!=e.indexOf(t)?!0:!1}function n(e,t,n){var r=n||[];return e.map(function(e){e.score=0,e.valuesMap={},t.filter(function(t,n){return t.placeid===e.id&&(e.valuesMap[t.indicatorid]=t,t.normalised=parseInt(t.normalised)||0,i(r,t.indicatorid)&&(e.score+=t.normalised)),!0})}),e}function r(e,t){var i=e;for(var n in i){var r=i[n].valuesMap,s=0;for(var o in r)t.indexOf(r[o].indicatorid)>-1&&(s+=r[o].normalised);i[n].score=s}return i}return{getData:e,prepareIndicators:t,preparePlaces:n,updateScores:r}}(),app=function(){function e(){$("#filter-dropdown ul").click(function(e){e.stopPropagation()})}function t(t,i,n){var r=services.prepareIndicators(i),s=services.preparePlaces(t,n,r.visible),o={indicators:r,places:s,sorting:{sort:utilities.sort,column:"title",direction:1},getIndicator:function(e,t){return this.get("indicators.all")[e][t]},isVisible:function(e){return this.get("indicators.visible").indexOf(e)>-1},removeIndicator:function(e,t){console.log(e,t)}};views.init(o),e()}function i(){services.getData(t)}return{start:i}}();