"use strict";Ractive.prototype.remove=function(t,e){var i=this.get(t),n=i.indexOf(e);return-1!==n?this.splice(t,n,1):Promise.defer()};var indicators=function(){function t(t){for(var e={},i=[],n=[],r=[],s=0;s<t.length;s++)utilities.isTrue(t[s].grouping)&&n.push(t[s].id),utilities.isTrue(t[s].scoring)&&(i.push(t[s].id),utilities.isTrue(t[s]["default"])&&r.push(t[s].id)),e[t[s].id]=t[s];return{all:e,scoring:i,grouping:n,visible:r}}function e(t,e){return-1!=t.indexOf(e)?!0:!1}function i(t,i,n){var r=n||[];return t.map(function(t){t.score=0,t.valuesMap={},i.filter(function(i,n){return i.placeid===t.id&&(t.valuesMap[i.indicatorid]=i,i.normalised=parseInt(i.normalised)||0,e(r,i.indicatorid)&&(i.visible=!0,t.score+=i.normalised)),!0})}),t}function n(t){var e=0;return e}return{calculate:n,indicators:t,places:i}}(),utilities=function(){function t(t,e,i){t=t.slice();var n=t.sort(function(t,n){return t[e]<n[e]?-i:i});return n}function e(t){return"y"===t.toLowerCase()||"true"===t.toLowerCase()||1==t?!0:!1}return{sort:t,isTrue:e}}(),services=function(){function t(t){var e="1kOOvztwbY1RNm545RKG8Ua6bh2GgX-P_wFadPkdH2ig";Tabletop.init({key:e,callback:t,simpleSheet:!1,prettyColumnNames:!1})}return{getData:t}}(),app=function(){function t(){$("#filter-dropdown ul").click(function(t){t.stopPropagation()})}function e(e,i){var n=i.sheets("places").elements,r=i.sheets("indicators").elements,s=i.sheets("values").elements,o=Ractive.extend({isolated:!1,template:"#template-filter"}),a=Ractive.extend({isolated:!1,template:"#template-grouping"}),c=indicators.indicators(r),u=new Ractive({el:"#table",template:"#template-table",data:{places:indicators.places(n,s,c.visible),indicators:{processed:c},sorting:{sort:utilities.sort,column:"title",direction:1},getIndicator:function(t,e){return this.get("indicators.processed.all")[t][e]},isVisible:function(t){return this.get("indicators.processed.visible").indexOf(t)>-1},updateScore:function(t){var e=this.get("places."+t+".valuesMap"),i=0;for(var n in e)this.get("indicators.processed.visible").indexOf(e[n].indicatorid)>-1&&(i+=e[n].normalised);return i}},computed:{},components:{filter:o,grouping:a}});console.log(u.get("places")),console.log(u.get("indicators")),u.on("sorting.sort",function(t,e){this.set("sorting.column",e),this.set("sorting.direction",-1*this.get("sorting.direction"))}),u.on("indicators.processed.visible",function(t,e){}),u.on("indicators.score",function(t){}),t()}function i(){services.getData(e)}return{start:i}}();